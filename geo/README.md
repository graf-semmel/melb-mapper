# geo/overpass-api.sh Developer README

## Overview

`overpass-api.sh` is a Bash script for downloading city boundary and suburb data from OpenStreetMap using the Overpass API. It outputs the results as JSON and GeoJSON files, suitable for use in mapping and data analysis projects.

## Requirements
- macOS or Linux
- [jq](https://stedolan.github.io/jq/) (for JSON processing)
- [curl](https://curl.se/) (for HTTP requests)
- [osmtogeojson](https://github.com/tyrasd/osmtogeojson) (for converting OSM JSON to GeoJSON)

Install dependencies using Homebrew and npm:
```sh
brew install jq curl
npm install osmtogeojson
```

## Usage

Run the script from the `geo` directory:

```sh
sh overpass-api.sh [OPTIONS] CITY_NAME
```

### Options
- `-b` : Extract only the city boundary (bounds)
- `-s` : Extract only the suburbs (admin_level 9) within the city
- `-a LEVEL` : Specify the city admin_level (default: 7)
- `-v` : Enable verbose debug output

**Note:** You must specify either `-b` or `-s` (not both).

### Examples

Get the boundary for "City of Brisbane":
```sh
sh overpass-api.sh -b -v -a 6 "City of Brisbane"
```

Get the suburbs for "Melbourne":
```sh
sh overpass-api.sh -s "Melbourne"
```

## Output Files

- City names are used as given for API queries.
- Output filenames are generated by converting the city name to lowercase and replacing spaces with hyphens.

For example, for `City of Brisbane`:
- Boundary: `city-of-brisbane-bounds.json`
- Suburbs (OSM): `city-of-brisbane-suburbs.osm.json`
- Suburbs (GeoJSON): `city-of-brisbane-suburbs.json`

## How It Works

1. **Dependency Check:** Ensures `jq`, `curl`, and `osmtogeojson` are installed.
2. **Argument Parsing:** Processes command-line options and city name.
3. **Query Construction:** Builds Overpass API queries for city boundaries or suburbs.
4. **API Request:** Sends the query to the Overpass API and saves the response.
5. **Processing:**
   - For bounds: Extracts bounding box from the response.
   - For suburbs: Converts OSM JSON to GeoJSON and filters for polygons.
6. **Output:** Saves results to appropriately named files in the `geo` directory.

## Troubleshooting
- Ensure all dependencies are installed and available in your PATH.
- If the Overpass API is slow or unresponsive, try again later.
- For cities with ambiguous names, specify the correct `admin_level` using `-a`.

## License
See the root `LICENSE` file for license information.
